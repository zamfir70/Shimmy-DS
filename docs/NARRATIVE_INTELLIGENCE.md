# 🧠 Shimmy-DS Recursive Narrative Intelligence

## Complete Guide to the World's First Recursive Narrative Tracking System

---

## 🎯 Overview

Shimmy-DS includes the **world's first implementation** of recursive narrative intelligence, designed to track, analyze, and enhance narrative coherence across any length of creative content. This system implements sophisticated concepts from advanced AI reasoning, cognitive science, and narrative theory.

### **What Makes It Revolutionary**

Unlike traditional AI writing tools that rely purely on context windows or training patterns, Shimmy-DS implements **active recursive tracking** across six integrated systems that monitor narrative health in real-time.

### **Core Philosophy**

- **Intelligence over Scale**: Focus on narrative coherence rather than just length
- **Creative Sovereignty**: Surface insights without constraining creativity
- **Recursive Awareness**: Track how narrative elements echo and transform across scales
- **Cross-System Integration**: Coordinate multiple tracking systems for holistic understanding

---

## 🧬 System Architecture

### **The Six Pillars of Recursive Intelligence**

```
┌─────────────────────────────────────────────────────────────────┐
│                 Recursive Narrative Assistant                  │
│                     (Unified Coordinator)                      │
├─────────────────────────────────────────────────────────────────┤
│  ┌─────────────────┐  ┌─────────────────┐  ┌─────────────────┐ │
│  │  🧬 CAPR DNA    │  │  🗺️ Constraint   │  │  🔄 Multi-Level │ │
│  │   Tracking      │  │  Space Model    │  │   Recursion     │ │
│  └─────────────────┘  └─────────────────┘  └─────────────────┘ │
│  ┌─────────────────┐  ┌─────────────────┐  ┌─────────────────┐ │
│  │  👥 Character   │  │  📚 Engagement  │  │  ⚖️ Drift       │ │
│  │  Consistency    │  │    Loops        │  │  Stabilizer     │ │
│  └─────────────────┘  └─────────────────┘  └─────────────────┘ │
└─────────────────────────────────────────────────────────────────┘
```

### **1. 🧬 CAPR Narrative DNA Tracking**

**Purpose**: Tracks the fundamental recursive loops that create narrative meaning.

**The CAPR Model**:
- **Contradiction**: Initial story tension (Hero wants X but fears Y)
- **Action**: Attempt to resolve contradiction
- **Pressure**: Unintended consequences that raise stakes
- **Return**: Recursive moment where elements come back transformed

**Example CAPR Loop**:
```
Contradiction: "Elena trusts logic but needs to trust intuition"
     ↓
Action: "Elena researches ancient texts for logical proof"
     ↓
Pressure: "Time runs out while Elena analyzes - crisis escalates"
     ↓
Return: "Elena must choose intuition over analysis to save everyone"
```

**Key Features**:
- Tracks unresolved contradictions
- Identifies return opportunities automatically
- Measures narrative DNA health (0.0-1.0)
- Suggests recursive developments without prescribing them

### **2. 🗺️ Constraint Space Modeling**

**Purpose**: Maps the evolving space of narrative possibilities as choices constrain future options.

**Constraint Types**:
- **Character State**: Personality traits that prevent certain actions
- **World Logic**: Rules of the story world that block scenarios
- **Genre Expectations**: Conventions that guide structure
- **Thematic Commitments**: Consistent stance on themes
- **Unresolved Threads**: Promises that must be kept

**Freedom Score Calculation**:
```
Freedom Score = Available Paths / Total Possible Paths
```

**Example Constraint Evolution**:
```
Chapter 1: Freedom = 0.9 (many possibilities open)
Chapter 5: Freedom = 0.6 (character traits established, some paths blocked)
Chapter 10: Freedom = 0.3 (approaching climax, few options remain)
Climax: Freedom = 0.1 (constraint singularity - resolution demanded)
```

### **3. 🔄 Multi-Level Recursion Tracking**

**Purpose**: Detects patterns and echoes across all narrative scales simultaneously.

**Tracked Levels**:
- **Sentence**: Individual lines, metaphors, dialogue
- **Paragraph**: Local meaning units and transitions
- **Scene**: Character interactions and plot beats
- **Chapter**: Major developments and arc progression
- **Act**: Large structural movements
- **Story**: Overall themes and meaning

**Recursion Types**:
- **Semantic Ripple**: A line reshapes paragraph intent
- **Emotional Cascade**: Tone builds scene pressure
- **Causal Leverage**: Conflict outcome redirects arc
- **Thematic Escalation**: Scenes reinforce themes
- **Structural Symmetry**: Beginning/end mirror each other
- **Symbolic Recursion**: Final sentence echoes first metaphor

**Example Cross-Scale Echo**:
```
Sentence (Ch. 1): "The mirror showed more than just reflection"
    ↓ (Symbolic recursion across 10 chapters)
Scene (Ch. 10): Elena finally sees truth in her own reflection
    ↓ (Thematic escalation)
Story: Theme of self-awareness completes its arc
```

### **4. 👥 Character Consistency Engine**

**Purpose**: Maintains deep personality, voice, and relationship tracking across any story length.

**Character Tracking Components**:

**Personality Traits**:
- Name, description, intensity (0.0-1.0)
- Stability score (how resistant to change)
- Manifestations (how trait typically shows)
- Contradictions (what would violate this trait)

**Dialogue Patterns**:
- Vocabulary level (formal, casual, technical)
- Sentence structure preferences
- Favorite phrases and speech quirks
- Emotional tells (how they speak when feeling X)
- Cultural markers and accents

**Character Arcs**:
- Arc theme (redemption, coming-of-age, fall from grace)
- Starting state → desired end state
- Current progress (0.0-1.0)
- Milestones, growth moments, regression moments
- Consistency with theme score

**Relationship Dynamics**:
- Trust level (-1.0 to 1.0)
- Emotional intimacy (0.0 to 1.0)
- Power dynamic (-1.0 to 1.0)
- Relationship history and significant events

**Consistency Violation Detection**:
- Personality contradictions
- Dialogue voice shifts
- Relationship inconsistencies
- Unexplained behavior changes
- Forgotten secrets or motivations

### **5. 📚 Reader Engagement Loop Detection**

**Purpose**: Tracks the psychological loops that keep readers invested in the story.

**Engagement Loop Types**:

**Curiosity → Hypothesis**:
- Reader forms theories about mysteries
- Hypothesis strength tracking
- Resolution expectation monitoring

**Emotional Investment → Payoff**:
- Investment in characters/situations
- Payoff expectation levels
- Satisfaction tracking

**Confusion → Pattern Recognition**:
- Reader seeks understanding of complex elements
- Pattern-seeking intensity monitoring
- "Aha moment" preparation

**Moral Tension → Reconciliation**:
- Ethical questions requiring resolution
- Tension level and urgency tracking
- Thematic consistency requirements

**Identity Alignment → Reflection**:
- Reader identification with characters
- Reflection depth and meaning
- Character growth mirroring

**Loop States**:
- **Initiation**: Loop begins with setup
- **Reinforcement**: Loop strengthened with additional elements
- **Complication**: Loop made more complex
- **Tease**: Tension maintained without resolution
- **Partial Resolution**: Some tension released
- **Full Resolution**: Loop completed
- **Subversion**: Expectations transformed

### **6. ⚖️ Recursive Drift Stabilization**

**Purpose**: Monitors long-term narrative health and prevents slow degradation over extended writing.

**Drift Indicators**:
- Unresolved obligation accumulation
- Stale obligations (unaddressed for multiple chapters)
- Emotional field decay
- Theme drift from original narrative goals
- Spatial return pressure loss (important locations forgotten)

**Predictive Analysis**:
- Trend detection across chapters
- Variance analysis for consistency
- Health score calculation
- Early warning system for narrative degradation

**Stabilization Recommendations**:
- Resolution suggestions for accumulated pressure
- Thematic reinforcement guidance
- Character development prompts
- Spatial return opportunities

---

## 🚀 Getting Started

### **1. Basic Setup**

```bash
# Install Shimmy with narrative intelligence
cargo install shimmy --features full

# Start with narrative intelligence enabled
shimmy serve --narrative-intelligence

# Configure narrative mode
shimmy serve --narrative-mode creative
```

### **2. Configuration**

Create `shimmy-ds.toml`:

```toml
[narrative]
enabled = true
assertiveness_level = 0.7  # 0.0 = passive, 1.0 = very active

[narrative.systems]
dna_tracking = true
constraint_modeling = true
recursion_tracking = true
character_consistency = true
engagement_loops = true
drift_stabilization = true

[narrative.sensitivity]
constraint_pressure = 0.7
character_drift = 0.8
unresolved_loops = 0.6
engagement_drops = 0.7
pattern_breaks = 0.5
```

### **3. API Usage**

```python
import openai
import requests

# Configure for Shimmy
openai.api_base = "http://127.0.0.1:11435/v1"
openai.api_key = "not-needed"

# Generate with narrative intelligence
response = openai.ChatCompletion.create(
    model="microsoft/Phi-3.5-mini-instruct",
    messages=[
        {"role": "user", "content": "Continue the story: Elena hesitated at the ancient door..."}
    ],
    max_tokens=1000
)

# Get narrative analysis
analysis = requests.get("http://127.0.0.1:11435/narrative/analyze").json()
print(f"Narrative health: {analysis['health_score']:.2f}")
print(f"Active patterns: {len(analysis['insights'])}")

# Get comprehensive report
report = requests.get("http://127.0.0.1:11435/narrative/report").text
print(report)
```

---

## 🔧 Advanced Usage

### **Configuring Assertiveness Levels**

| Level | Behavior | Insights Generated | Use Case |
|-------|----------|-------------------|----------|
| **0.1-0.3** | Very Passive | Only critical issues | Experienced writers who want minimal interference |
| **0.4-0.6** | Balanced | Important patterns | General creative writing |
| **0.7-0.9** | Active | Comprehensive guidance | Learning writers, complex projects |
| **1.0** | Maximum | All detected patterns | Analytical mode, debugging narratives |

### **System-Specific Configuration**

```rust
use shimmy::recursive_narrative_assistant::*;

// Create custom configuration
let mut config = AssistantConfig::default();

// Configure specific systems
config.enabled_systems.dna_tracking = true;
config.enabled_systems.character_consistency = true;
config.enabled_systems.engagement_loops = false;  // Disable if not needed

// Adjust sensitivity thresholds
config.sensitivity.constraint_pressure = 0.8;  // Only flag major constraints
config.sensitivity.character_drift = 0.9;      // Very sensitive to character issues

// Create assistant with custom config
let assistant = RecursiveNarrativeAssistant::with_config(config);
```

### **Real-Time Narrative Event Recording**

```rust
// Record character actions
assistant.record_narrative_event(NarrativeEvent::CharacterAction {
    character: "Elena".to_string(),
    action: "chooses to trust her intuition".to_string(),
    motivation: "desperation and growing wisdom".to_string(),
});

// Record dialogue for voice consistency
assistant.record_narrative_event(NarrativeEvent::DialogueSpoken {
    character: "Elena".to_string(),
    dialogue: "I suppose... perhaps logic isn't everything.".to_string(),
    emotional_context: "reluctant acceptance".to_string(),
});

// Record symbolic elements
let mirror_element = RecursiveElement {
    id: "broken_mirror".to_string(),
    content: "The mirror cracked, showing fractured reflections".to_string(),
    level: NarrativeLevel::Sentence,
    // ... other properties
};

assistant.record_narrative_event(NarrativeEvent::RecursiveElement {
    element: mirror_element,
});
```

---

## 📊 Understanding Insights

### **Insight Types and Meanings**

**🧬 DNA Pattern Insights**:
- **"CAPR Health Degraded"**: Too many unresolved contradictions
- **"Return Opportunity"**: Element ready for recursive callback
- **"Pressure Buildup"**: Consequences accumulating tension

**🗺️ Constraint Pressure Insights**:
- **"Freedom Constrained"**: Narrative approaching convergence
- **"Path Blocked"**: Character constraints preventing actions
- **"Constraint Singularity"**: All paths lead to resolution

**🔄 Recursion Insights**:
- **"Pattern Echo Opportunity"**: Theme could resonate across levels
- **"Cross-Scale Disconnection"**: Sentence-level not supporting story-level
- **"Symbolic Return"**: Symbol ready for transformed reappearance

**👥 Character Insights**:
- **"Voice Inconsistency"**: Dialogue doesn't match established pattern
- **"Personality Drift"**: Actions contradict established traits
- **"Arc Stagnation"**: Character development has plateaued

**📚 Engagement Insights**:
- **"Loop Attention Required"**: Engagement pattern needs reinforcement
- **"Tension Overload"**: Too many unresolved loops competing
- **"Payoff Expectation"**: Reader investment ready for resolution

**⚖️ Drift Alerts**:
- **"Long-term Stability Concern"**: Narrative health declining over time
- **"Thematic Drift"**: Story moving away from core themes
- **"Obligation Accumulation"**: Too many unresolved promises

### **Insight Priority Levels**

**🔴 Critical**: Immediate attention required - narrative integrity at risk
**🟡 High**: Important issue that should be addressed soon
**🔵 Medium**: Optimization opportunity worth considering
**⚪ Low**: Minor suggestion for enhancement

### **Sample Insight Report**

```
🤖 NARRATIVE INSIGHTS (Chapter 5, Scene 2)

🔴 Critical - Character Consistency: Elena
   Elena's recent dialogue contradicts her established formal speech pattern
   Consider: Does this represent intentional character growth or inconsistency?
   Suggestion: Add internal monologue explaining the shift, or adjust dialogue

🟡 High - CAPR Pattern: Logic vs Intuition
   Contradiction "logic vs intuition" showing high pressure (2.4/3.0)
   Consider: Is this the right moment for Elena to make her choice?
   Suggestion: Climactic decision point may be approaching naturally

🔵 Medium - Recursive Echo: Mirror Symbol
   Mirror symbol from Chapter 1 could resonate with current self-reflection scene
   Consider: Would echoing the mirror metaphor deepen the thematic impact?
   Suggestion: Brief callback could strengthen symbolic coherence

🔵 Medium - Engagement Loop: Mystery Resolution
   "What caused the magical anomaly?" loop needs reinforcement or resolution
   Consider: Has enough time passed since the last clue?
   Suggestion: Small revelation could maintain reader investment
```

---

## 🎨 Creative Writing Workflows

### **Workflow 1: Discovery Writing with Intelligence**

For writers who prefer to discover the story as they write:

```bash
# Start with low assertiveness to avoid interrupting flow
shimmy serve --narrative-assertiveness 0.3 --enable-drift-stabilization

# Write freely, check insights periodically
curl http://127.0.0.1:11435/narrative/analyze | jq '.insights[] | select(.priority == "Critical" or .priority == "High")'
```

### **Workflow 2: Structured Writing with Full Intelligence**

For writers who want comprehensive guidance:

```bash
# Enable all systems with high assertiveness
shimmy serve --narrative-assertiveness 0.8 --enable-all-systems

# Get insights before writing each scene
curl http://127.0.0.1:11435/narrative/report > current_state.md
```

### **Workflow 3: Revision and Editing**

For polishing existing work:

```bash
# Maximum intelligence for analytical review
shimmy serve --narrative-assertiveness 1.0

# Import existing story for analysis
# (Implementation would support text import and analysis)
```

### **Workflow 4: Collaborative Writing**

For multiple authors working on the same story:

```bash
# Shared narrative state with high character consistency tracking
shimmy serve --narrative-mode collaborative --enable-character-consistency

# Each author can check consistency before writing
curl http://127.0.0.1:11435/narrative/character/Elena
```

---

## 🔍 Debugging Narrative Issues

### **Common Issues and Solutions**

**Problem**: "My story feels like it's meandering"
- **Check**: Constraint pressure and DNA health
- **Look for**: Low pressure scores, few active contradictions
- **Solution**: Introduce new tension or escalate existing conflicts

**Problem**: "Characters feel inconsistent"
- **Check**: Character consistency scores and violation reports
- **Look for**: Voice drift, personality contradictions
- **Solution**: Review character profiles, add development justification

**Problem**: "Readers seem to lose interest"
- **Check**: Engagement loop analysis and retention score
- **Look for**: Stale loops, lack of reinforcement, missing payoffs
- **Solution**: Reinforce active loops or provide partial resolution

**Problem**: "Plot feels rushed or forced"
- **Check**: Constraint space freedom score
- **Look for**: Rapid freedom decrease, blocked paths
- **Solution**: May be approaching natural convergence, or add complications

**Problem**: "Story feels repetitive"
- **Check**: Multi-level recursion analysis
- **Look for**: High recursion density, low transformation
- **Solution**: Vary recursive patterns, add new elements

### **Diagnostic Commands**

```bash
# Get overall health summary
curl http://127.0.0.1:11435/narrative/health

# Check specific character consistency
curl http://127.0.0.1:11435/narrative/character/CHARACTER_NAME

# Analyze engagement patterns
curl http://127.0.0.1:11435/narrative/engagement

# Get constraint space visualization
curl http://127.0.0.1:11435/narrative/constraints

# Check for drift over time
curl http://127.0.0.1:11435/narrative/drift
```

---

## 📈 Performance Considerations

### **Memory Usage**

| Component | Base Memory | Per Character | Per Chapter |
|-----------|-------------|---------------|-------------|
| CAPR DNA Tracker | 5MB | - | 50KB |
| Constraint Space | 3MB | 10KB | 30KB |
| Multi-Level Recursion | 8MB | - | 100KB |
| Character Engine | 2MB | 500KB | 10KB |
| Engagement Loops | 4MB | 50KB | 20KB |
| Drift Stabilizer | 1MB | - | 5KB |
| **Total** | **~25MB** | **~560KB** | **~215KB** |

### **Performance Optimization**

```toml
[narrative.performance]
# Disable unused systems to save memory
enabled_systems = ["dna_tracking", "character_consistency"]

# Reduce analysis frequency for better performance
analysis_frequency = "natural_breakpoints"  # vs "continuous"

# Limit tracking depth
max_recursion_depth = 5
max_character_count = 10
max_engagement_loops = 15

# Cleanup settings
auto_cleanup_resolved = true
max_history_retention_days = 30
```

### **Scaling Considerations**

- **Short stories** (< 10K words): All systems, maximum assertiveness
- **Novels** (10K-100K words): Selective systems, balanced assertiveness
- **Series** (100K+ words): Essential systems only, lower assertiveness
- **Interactive fiction**: Full systems, high responsiveness
- **Collaborative**: Character consistency + constraint tracking focus

---

## 🔮 Future Enhancements

### **Planned Features**

**Phase 2**:
- Visual narrative mapping and visualization
- Integration with external writing tools
- Export/import of narrative state
- Collaborative real-time editing support

**Phase 3**:
- Machine learning enhancement of pattern detection
- Genre-specific intelligence modules
- Adaptive learning from user feedback
- Advanced predictive suggestions

**Phase 4**:
- Cross-media narrative tracking (books → movies → games)
- Integration with publishing workflows
- Community narrative intelligence sharing
- Research applications for narrative studies

---

## 💡 Best Practices

### **Getting the Most from Narrative Intelligence**

1. **Start Small**: Begin with 2-3 systems enabled
2. **Adjust Gradually**: Increase assertiveness as you get comfortable
3. **Review Regularly**: Check insights at natural breakpoints
4. **Trust Your Instincts**: The system suggests, you decide
5. **Experiment**: Try different configurations for different projects

### **When to Use High vs Low Assertiveness**

**High Assertiveness (0.7-1.0)**:
- Learning complex narrative techniques
- Debugging problematic stories
- Collaborative projects requiring consistency
- Academic analysis of narrative structure

**Low Assertiveness (0.1-0.4)**:
- Free-flowing creative writing
- Experienced authors who want minimal interference
- Experimental or avant-garde narratives
- Discovery writing processes

### **System Combinations for Different Genres**

**Literary Fiction**:
- Character Consistency + Multi-Level Recursion + Drift Stabilization

**Mystery/Thriller**:
- CAPR DNA + Engagement Loops + Constraint Space

**Fantasy/Sci-Fi**:
- All systems enabled (complex world-building needs full tracking)

**Romance**:
- Character Consistency + Engagement Loops + CAPR DNA

**Interactive Fiction**:
- Constraint Space + Character Consistency + Engagement Loops

---

This comprehensive guide covers the complete recursive narrative intelligence system. For specific implementation details, see the API documentation and code examples in the repository.